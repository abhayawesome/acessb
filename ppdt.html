<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PPDT / TAT Practice - Ace SSB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #0a192f;
        color: #ccd6f6;
      }
      .text-accent {
        color: #64ffda;
      }
      .bg-accent {
        background-color: #64ffda;
      }
      .glass-effect {
        background: rgba(23, 49, 85, 0.6);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      #timer-display {
        text-shadow: 0 0 10px rgba(100, 255, 218, 0.7);
      }
    </style>
  </head>
  <body class="antialiased">
    <!-- Header -->
    <header id="navbar" class="glass-effect sticky top-0 left-0 right-0 z-50">
      <div class="container mx-auto px-6 py-4">
        <div class="flex items-center justify-between">
          <a
            href="index.html"
            class="text-2xl font-bold text-white hover:text-accent transition-colors"
            >Ace SSB</a
          >
          <nav class="hidden md:flex items-center space-x-8">
            <a href="index.html" class="text-gray-300 hover:text-accent"
              >Home</a
            >
            <a href="ppdt.html" class="text-accent font-bold">PPDT / TAT</a>
            <a href="wat.html" class="text-gray-300 hover:text-accent">WAT</a>
            <a href="srt.html" class="text-gray-300 hover:text-accent">SRT</a>
          </nav>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-12">
      <div id="setup-screen" class="text-center">
        <h1 class="text-3xl md:text-4xl font-bold text-white mb-4">
          PPDT / TAT Practice
        </h1>
        <p class="text-gray-400 max-w-2xl mx-auto mb-2">
          You will be shown 11 pictures and one blank slide.
        </p>
        <p class="text-yellow-400 text-sm max-w-2xl mx-auto mb-8">
          Test Flow: 30 seconds to observe, then 4 minutes to write the story on
          paper.
        </p>
        <button
          id="start-btn"
          class="bg-accent text-slate-900 font-bold py-3 px-8 rounded-md hover:bg-opacity-80 transition-all text-lg"
        >
          Start Test
        </button>
      </div>

      <div id="test-screen" class="hidden text-center max-w-4xl mx-auto">
        <h2 id="slide-counter" class="text-xl font-bold text-white mb-4"></h2>
        <div
          id="image-container"
          class="w-full mx-auto mb-4 aspect-video bg-black rounded-lg overflow-hidden flex items-center justify-center glass-effect"
        >
          <img
            id="test-image"
            src=""
            alt="PPDT/TAT Slide"
            class="max-w-full max-h-full hidden"
          />
          <div id="blank-slide" class="hidden text-2xl text-gray-400">
            Blank Slide
          </div>
        </div>
        <div class="text-center">
          <p id="phase-title" class="text-2xl font-bold text-accent mb-2">
            Observe the Picture
          </p>
          <p id="timer-display" class="text-6xl font-mono font-bold text-white">
            00:30
          </p>
          <div class="mt-6 flex justify-center items-center gap-4">
            <button
              id="prev-btn"
              class="bg-slate-700 text-white font-bold py-2 px-6 rounded-md hover:bg-slate-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Previous
            </button>
            <button
              id="next-btn"
              class="bg-accent text-slate-900 font-bold py-2 px-8 rounded-md hover:bg-opacity-80 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Next
            </button>
          </div>
          <button
            id="end-test-btn"
            class="mt-6 bg-red-600 text-white font-bold py-2 px-6 rounded-md hover:bg-red-500 transition-all"
          >
            End Test
          </button>
        </div>
      </div>

      <div id="end-screen" class="hidden text-center">
        <h1 class="text-3xl md:text-4xl font-bold text-white mb-4">
          Test Complete!
        </h1>
        <p class="text-gray-400 max-w-2xl mx-auto mb-8">
          Great work. Consistent practice is the key to success. You can restart
          the test or try another module.
        </p>
        <button
          id="restart-btn"
          class="bg-accent text-slate-900 font-bold py-3 px-8 rounded-md hover:bg-opacity-80 transition-all text-lg"
        >
          Restart Test
        </button>
      </div>

      <!-- Purchase Callout -->
      <div class="mt-24 max-w-3xl mx-auto">
        <div
          class="glass-effect rounded-lg p-8 text-center border-t-4 border-accent"
        >
          <h3 class="text-2xl font-bold text-white mb-3">
            Get the Full PPDT / TAT Image Pack
          </h3>
          <p class="text-gray-400 mb-6">
            Download the complete collection of PPDT/TAT images in a
            single PDF.
          </p>
          <a
            href="https://pages.razorpay.com/Ananta"
            target="_blank"
            class="purchase-link bg-slate-700 text-white font-bold py-2 px-6 rounded-md hover:bg-accent hover:text-slate-900 transition-all"
            >Purchase the PDF</a
          >
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 mt-16 border-t border-slate-700">
      <div class="container mx-auto px-6 py-8 text-center">
        <p class="text-sm text-gray-500">
          &copy; 2014-2025 Ace SSB. All Rights Reserved.
        </p>
      </div>
    </footer>

    <!-- Confirmation Modal -->
    <div
      id="redirect-modal"
      class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100] hidden"
    >
      <div class="glass-effect rounded-lg p-8 max-w-sm mx-auto text-center">
        <h3 class="text-xl font-bold text-white mb-4">Leaving Ace SSB</h3>
        <p class="text-gray-300 mb-6">
          You are being redirected to our secure payment partner's website to
          complete your purchase. Do you want to continue?
        </p>
        <div class="flex justify-center space-x-4">
          <button
            id="cancel-redirect-btn"
            class="bg-gray-600 text-white font-bold py-2 px-6 rounded-md hover:bg-gray-500 transition-all"
          >
            Cancel
          </button>
          <a
            id="confirm-redirect-btn"
            href="#"
            target="_blank"
            class="bg-accent text-slate-900 font-bold py-2 px-6 rounded-md hover:bg-opacity-80 transition-all"
            >Continue</a
          >
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const setupScreen = document.getElementById("setup-screen");
        const testScreen = document.getElementById("test-screen");
        const endScreen = document.getElementById("end-screen");

        const startBtn = document.getElementById("start-btn");
        const restartBtn = document.getElementById("restart-btn");
        const endTestBtn = document.getElementById("end-test-btn");
        const prevBtn = document.getElementById("prev-btn");
        const nextBtn = document.getElementById("next-btn");

        const testImage = document.getElementById("test-image");
        const blankSlide = document.getElementById("blank-slide");
        const imageContainer = document.getElementById("image-container");
        const slideCounter = document.getElementById("slide-counter");
        const phaseTitle = document.getElementById("phase-title");
        const timerDisplay = document.getElementById("timer-display");

        const TOTAL_IMAGES = 116;
        const BLANK_IMAGE_NUM = 117; // This is a marker
        const BASE_URL =
          "https://pub-90f1278f2a1d419e9469b9828b225dd5.r2.dev/image/";

        let imageSet = [];
        let currentImageIndex = 0;
        let timerInterval;

        function generateImageSet() {
          imageSet = [];
          const availableNumbers = Array.from(
            { length: TOTAL_IMAGES },
            (_, i) => i + 1
          );
          for (let i = 0; i < 11; i++) {
            const randomIndex = Math.floor(
              Math.random() * availableNumbers.length
            );
            const chosenNumber = availableNumbers.splice(randomIndex, 1)[0];
            imageSet.push(chosenNumber);
          }
          imageSet.push(BLANK_IMAGE_NUM); // Add blank slide marker at the end
        }

        function padNumber(num) {
          return String(num).padStart(3, "0");
        }

        function formatTime(seconds) {
          const mins = Math.floor(seconds / 60);
          const secs = seconds % 60;
          return `${String(mins).padStart(2, "0")}:${String(secs).padStart(
            2,
            "0"
          )}`;
        }

        function startTimer(duration, onTick, onEnd) {
          clearInterval(timerInterval);
          let timeLeft = duration;
          onTick(timeLeft);
          timerInterval = setInterval(() => {
            timeLeft--;
            onTick(timeLeft);
            if (timeLeft <= 0) {
              clearInterval(timerInterval);
              onEnd();
            }
          }, 1000);
        }

        function updateNavButtons() {
          prevBtn.disabled = currentImageIndex === 0;
          nextBtn.disabled = currentImageIndex === imageSet.length - 1;
        }

        function runPicturePhase() {
          clearInterval(timerInterval); // Stop any previous timers
          imageContainer.classList.remove("bg-gray-900");
          updateNavButtons();

          const imageNum = imageSet[currentImageIndex];
          slideCounter.textContent = `Picture ${currentImageIndex + 1} of ${
            imageSet.length
          }`;

          testImage.onerror = () => {
            console.error(
              `Failed to load image tat${padNumber(
                imageNum
              )}.jpg. Skipping to next.`
            );
            if (currentImageIndex < imageSet.length - 1) {
              currentImageIndex++;
              runPicturePhase();
            } else {
              endTest();
            }
          };

          // --- Phase 1: Observe ---
          phaseTitle.textContent = "Observe the Picture";
          if (imageNum === BLANK_IMAGE_NUM) {
            testImage.classList.add("hidden");
            blankSlide.classList.remove("hidden");
          } else {
            blankSlide.classList.add("hidden");
            testImage.src = `${BASE_URL}tat${padNumber(imageNum)}.jpg`;
            testImage.classList.remove("hidden");
          }

          startTimer(
            30,
            (time) => (timerDisplay.textContent = formatTime(time)),
            () => {
              // --- Phase 2: Write ---
              testImage.classList.add("hidden");
              blankSlide.classList.add("hidden");
              imageContainer.classList.add("bg-gray-900"); // Make container dark
              phaseTitle.textContent = "Write Story on Paper";
              startTimer(
                240,
                (time) => (timerDisplay.textContent = formatTime(time)),
                () => {
                  phaseTitle.textContent = "Time's Up! Proceed when ready.";
                }
              );
            }
          );
        }

        function startTest() {
          generateImageSet();
          currentImageIndex = 0;
          setupScreen.classList.add("hidden");
          endScreen.classList.add("hidden");
          testScreen.classList.remove("hidden");
          runPicturePhase();
        }

        function endTest() {
          clearInterval(timerInterval);
          testScreen.classList.add("hidden");
          endScreen.classList.remove("hidden");
        }

        // --- Event Listeners ---
        startBtn.addEventListener("click", startTest);
        restartBtn.addEventListener("click", startTest);
        endTestBtn.addEventListener("click", endTest);

        nextBtn.addEventListener("click", () => {
          if (currentImageIndex < imageSet.length - 1) {
            currentImageIndex++;
            runPicturePhase();
          }
        });

        prevBtn.addEventListener("click", () => {
          if (currentImageIndex > 0) {
            currentImageIndex--;
            runPicturePhase();
          }
        });

        imageContainer.addEventListener("contextmenu", (e) =>
          e.preventDefault()
        );

        // --- Redirect Confirmation Modal Script ---
        const redirectModal = document.getElementById("redirect-modal");
        const cancelRedirectBtn = document.getElementById(
          "cancel-redirect-btn"
        );
        const confirmRedirectBtn = document.getElementById(
          "confirm-redirect-btn"
        );
        const purchaseLinks = document.querySelectorAll(".purchase-link");

        if (
          redirectModal &&
          cancelRedirectBtn &&
          confirmRedirectBtn &&
          purchaseLinks
        ) {
          purchaseLinks.forEach((link) => {
            link.addEventListener("click", function (e) {
              e.preventDefault();
              const targetUrl = this.href;
              confirmRedirectBtn.href = targetUrl;
              redirectModal.classList.remove("hidden");
            });
          });

          cancelRedirectBtn.addEventListener("click", () => {
            redirectModal.classList.add("hidden");
          });

          redirectModal.addEventListener("click", function (event) {
            if (event.target === redirectModal) {
              redirectModal.classList.add("hidden");
            }
          });

          confirmRedirectBtn.addEventListener("click", () => {
            setTimeout(() => {
              redirectModal.classList.add("hidden");
            }, 100);
          });
        }
      });
    </script>
  </body>
</html>

